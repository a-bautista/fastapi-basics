Generic single-database configuration.

# How to Add New Tables with Alembic

## Overview

We've set up Alembic with an initial "stamp" migration that recognizes the existing database state without trying to recreate tables. This approach solves the "relation already exists" error while allowing you to add new tables or modify existing ones.

## Adding a New Table (e.g., "prompts")

### 1. Create the SQLAlchemy model

First, create a new model file (e.g., `app/models/prompt.py`):

```python
from sqlalchemy import Column, Integer, String, Text, ForeignKey, DateTime
from sqlalchemy.sql import func
from datetime import datetime
from sqlalchemy.orm import relationship

from app.models.base import Base

class Prompt(Base):
    __tablename__ = "prompts"
    
    id = Column(Integer, primary_key=True, index=True)
    title = Column(String(255), nullable=False)
    content = Column(Text, nullable=False)
    user_id = Column(Integer, ForeignKey("users.id"), nullable=False)
    created_at = Column(DateTime, default=datetime.utcnow)
    updated_at = Column(DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)
    
    # Relationship to User (optional)
    # user = relationship("User", back_populates="prompts")
```

### 2. Import the model in `app/models/__init__.py`

```python
from app.models.user import User
from app.models.prompt import Prompt  # Add this line
```

### 3. Generate a migration for the new table

Run:
```bash
docker-compose exec api alembic revision --autogenerate -m "Add prompts table"
```

This will create a new migration file in `migrations/versions/` that adds the prompts table.

### 4. Apply the migration

```bash
docker-compose exec api alembic upgrade head
```

## Modifying an Existing Table

Follow the same process, but instead of creating a new model, modify an existing one (e.g., add a column to the User model). Then generate and apply the migration.

## Common Commands

- Check current database version:
  ```bash
  docker-compose exec api alembic current
  ```

- View migration history:
  ```bash
  docker-compose exec api alembic history
  ```

- Downgrade to previous version:
  ```bash
  docker-compose exec api alembic downgrade -1
  ```

## Troubleshooting

- If you get "table already exists" errors, you might need to:
  1. Manually edit the migration file to remove the creation of existing tables
  2. Use `alembic stamp` to mark a revision as applied without running it

- If autogenerated migrations don't detect your changes:
  1. Make sure your models are imported in `app/models/__init__.py`
  2. Try creating a manual migration instead